<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">

<head>
    <meta charset="UTF-8">
    <title>userInfo</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/bootstrap-theme.min.css">
    <script src="../js/jquery-3.4.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/jquery.page.js"></script>
</head>

<body>
<div class="container-fluid" style="margin: 1% 3%">
    <div class="row">
        <div class="userinfo col-md-4 col-xs-12">
            <img id="head" th:src="'../'+${headimg}">
            <h1 id="nickname" th:text="${nickname}">nickname</h1>
            <p id="bio" th:text="bio">bio</p>
        </div>


        <div class="details col-md-8 col-xs-12">
            <div class="primary col-md-12">
                <h2><span class="label label-primary">Themes published</span>
                </h2>
            </div>

            <div class="boundary">
                <div class="col-md-12">
                    <hr>
                </div>
            </div>

            <div class="col-md-11" id="themes">
            </div>

            <div class="page col-md-12" style="text-align: center">
                <ul class="pagination" id="paginator"></ul>
            </div>

        </div>
    </div>
</div>
</div>

</body>

<style>
    .themes .media {
        padding: 1.5rem 1rem;
        margin: 3% 2%;
    }

    img#head {
        height: 35vh;
        width: 35vh;
    }

    .container-fluid {
        border: 1px solid rgb(204, 203, 203);
        border-radius: 1rem;
        padding: 1rem;
        margin-top: 1%;
        margin-bottom: 3%;
        background-color: rgb(255, 255, 255);
    }

    body {
        background: radial-gradient(circle, rgb(117, 117, 117) 5%, rgb(189, 192, 192) 70%, rgb(255, 255, 255))
    }

    .userinfo {
        padding: 3%;
    }
</style>
<script>
    $(getThemes(1))

    function getThemes(page) {
        $.ajax({
            type: "GET",
            url: "/themes/" + getUid() + "?page=" + page,
            success: function (result) {
                var themes = eval(JSON.parse(result).data.list);
                cleanThemeDiv();
                for (var i = 0; i < themes.length; i++) {
                    addThemeDiv(themes[i]);
                }
                var themeNum = JSON.parse(result).data.num;
                if (themeNum > 5) {
                    addPaginator(themeNum, page);
                }
            },
            error: function () {
                alert("客户端出错")
            }
        })

    }

    function getUid() {
        var query = window.location.href;
        var vars = query.split("/");
        return vars[vars.length - 1].split("?")[0];
    }

    function cleanThemeDiv() {
        document.getElementById("themes").innerHTML="";
    }

    function addThemeDiv(theme) {
        var divChildTemplate = document.createElement("div");
        divChildTemplate.className = "media alert alert-info";
        divChildTemplate.setAttribute("role", "alert");
        var title = document.createElement("h3");
        title.className = "media-heading";
        title.innerText = theme.title;
        var detail = document.createElement("p");
        detail.innerText = theme.description;
        var a = document.createElement("a");
        a.setAttribute("href", "/themes/" + theme.id);
        a.appendChild(title);
        a.appendChild(detail);
        divChildTemplate.appendChild(a);
        document.getElementById('themes').appendChild(divChildTemplate);
    }

    function addPaginator(num, currentPage) {
        var pageNum = parseInt(num / 5)+1;
        $("#paginator").createPage({
            pageCount: pageNum,
            current: currentPage,
            backFn: function (p) {
                getThemes(p);
            }
        });

    }
</script>
</html>